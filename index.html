<!DOCTYPE html>
<html>
<head>
  <title>Modelling graph data in Neo4j and visualising in R</title>
  <meta charset="utf-8">
  <meta name="description" content="Modelling graph data in Neo4j and visualising in R">
  <meta name="author" content="Wesley GOI">
  <meta name="generator" content="slidify" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <link rel="stylesheet" href="libraries/frameworks/io2012/css/default.css" media="all" >
  <link rel="stylesheet" href="libraries/frameworks/io2012/css/phone.css" 
    media="only screen and (max-device-width: 480px)" >
  <link rel="stylesheet" href="libraries/frameworks/io2012/css/slidify.css" >
  <link rel="stylesheet" href="libraries/highlighters/highlight.js/css/tomorrow.css" />
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->  <link rel=stylesheet href="./assets/css/ribbons.css"></link>

  
  <!-- Grab CDN jQuery, fall back to local if offline -->
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.min.js"></script>
  <script>window.jQuery || document.write('<script src="libraries/widgets/quiz/js/jquery.js"><\/script>')</script> 
  <script data-main="libraries/frameworks/io2012/js/slides" 
    src="libraries/frameworks/io2012/js/require-1.0.8.min.js">
  </script>
  
  

</head>
<body style="opacity: 0">
  <slides class="layout-widescreen">
    
    <!-- LOGO SLIDE -->
        <slide class="title-slide segue nobackground">
  <hgroup class="auto-fadein">
    <h1>Modelling graph data in Neo4j and visualising in R</h1>
    <h2>Using SHINY, HTMLWIDGETS, IGRAPH</h2>
    <p>Wesley GOI<br/>Graph Enthusiast</p>
  </hgroup>
  <article></article>  
</slide>
    

    <!-- SLIDES -->
    <slide class="" id="slide-1" style="background:;">
  <article data-timings="">
    <style>
.sessionInfo code{
  font-size: 60%;
   }

pre {
 white-space: pre-wrap;       /* css-3 */
 white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
 white-space: -pre-wrap;      /* Opera 4-6 */
 white-space: -o-pre-wrap;    /* Opera 7 */
 word-wrap: break-word;       /* Internet Explorer 5.5+ */
 text-align: left
}

article div h3{
 text-align: left
}

.title-slide {
    background-color: #FFF
}

img {
  max-height: 560px;
  max-width: 964px;
}
</style>

<h2>Background</h2>

<ul>
<li>Neo4j is a noSQL database which models its data as a graph</li>
<li>latest version is 2.3.1</li>
</ul>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-2" style="background:;">
  <hgroup>
    <h2>Outline</h2>
  </hgroup>
  <article data-timings="">
    <ol>
<li>Using RNeo4j to connect with a hosted graphDB via Neo4j&#39;s REST API</li>
<li>Executing cypher queries</li>
<li>Using <code>IGRAPH</code> to plot and visualise data locally.</li>
<li>Using <code>SHINY</code> and a <code>HTMLTOOLS</code> package <code>SIGMA</code> to interactively visualise graph data in a dashboard</li>
</ol>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-3" style="background:;">
  <hgroup>
    <h2>What is a graph</h2>
  </hgroup>
  <article data-timings="">
    
<div style='float:left;width:48%;' class='centered'>
  <p><img src="assets/fig/createRandomGraph-1.png" alt="plot of chunk createRandomGraph"> </p>

</div>
<div style='float:right;width:48%;'>
  <ul>
<li><strong>Lines</strong> are edges</li>
<li><strong>Circles</strong> are nodes / vertices</li>
</ul>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-4" style="background:;">
  <hgroup>
    <h2>Why NEO4J - Pattern Search</h2>
  </hgroup>
  <article data-timings="">
    <p><img src="./assets/img/pattern.png" height="60%", width="50%"></p>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-5" style="background:;">
  <hgroup>
    <h2>Why use NEO4J</h2>
  </hgroup>
  <article data-timings="">
    <ul>
<li>Pattern Search</li>
</ul>

<div style='float:left;width:48%;' class='centered'>
  <p><img src="./assets/img/noi.png" height=300px, width=300px></p>

</div>
<div style='float:right;width:48%;'>
  <p><img src="./assets/img/noi2.png" height=300px, width=300px></p>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-6" style="background:;">
  <hgroup>
    <h2>Why NEO4J?</h2>
  </hgroup>
  <article data-timings="">
    <h3>CYPHER allows for path based queries</h3>

<div style='float:left;width:48%;' class='centered'>
  <p><img src="./assets/img/path.svg" height=300px, width=300px></p>

</div>
<div style='float:right;width:48%;'>
  <ul>
<li>CYPHER allows for an ASCII representation of a path</li>
</ul>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-7" style="background:;">
  <hgroup>
    <h2>NODE LABELS</h2>
  </hgroup>
  <article data-timings="">
    
<div style='float:left;width:48%;' class='centered'>
  <p><img src="./assets/img/label.svg" height=300px, width=300px></p>

</div>
<div style='float:right;width:48%;'>
  <ul>
<li>Finds nodes which of a certain type</li>
<li>Find paths constructed by these nodes</li>
</ul>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-8" style="background:;">
  <hgroup>
    <h2>CYPHER: EDGE LABELS</h2>
  </hgroup>
  <article data-timings="">
    
<div style='float:left;width:48%;' class='centered'>
  <p><img src="./assets/img/edge.svg" height=300px, width=300px></p>

</div>
<div style='float:right;width:48%;'>
  <ul>
<li>Finds nodes which of a certain type</li>
<li>Find patterns made up of these nodes</li>
</ul>

<pre><code class="cypher">MATCH
    (A:girl) -[:likes]-&gt; (B:boy)
RETURN
    A, B
</code></pre>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-9" style="background:;">
  <hgroup>
    <h2>CYPHER: Path</h2>
  </hgroup>
  <article data-timings="">
    
<div style='float:left;width:48%;' class='centered'>
  <p><img src="./assets/img/edge.svg" height=300px, width=300px></p>

</div>
<div style='float:right;width:48%;'>
  <ul>
<li>Finds nodes which of a certain type</li>
<li>Find patterns made up of these nodes</li>
</ul>

<pre><code class="cypher">MATCH
    (A: girl {name: &#39;ally&#39;})-[:likes]-&gt;(B: boy)
RETURN
    B
</code></pre>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-10" style="background:;">
  <hgroup>
    <h2>Using R with Neo4j</h2>
  </hgroup>
  <article data-timings="">
    <pre><code class="r">library(RNeo4j)
</code></pre>

<h2>1. Connect with Neo4j</h2>

<pre><code class="r">graph &lt;- startGraph(&quot;http://metamaps.scelse.nus.edu.sg:7474/db/data/&quot;,
            user = cred$user,
            pass = cred$pass)
</code></pre>

<h3>Security</h3>

<p>Set the following if you wish to DISABLE user password login:
<code>dbms.security.auth_enabled=false</code> to in <code>conf/neo4j-server.properties</code>.</p>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-11" style="background:;">
  <hgroup>
    <h2>Cypher Functions 101</h2>
  </hgroup>
  <article data-timings="">
    <h3>Finding a node</h3>

<pre><code class="cypher">MATCH (label: {property: })
</code></pre>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-12" style="background:;">
  <hgroup>
    <h2>2. Sending A query</h2>
  </hgroup>
  <article data-timings="">
    
<div style='float:left;width:48%;' class='centered'>
  <h3>Cypher Query</h3>

<pre><code class="cypher">MATCH
    (koi:ko {ko:&#39;ko:K00531&#39;})
RETURN
    koi
</code></pre>

<ul>
<li>Search for a node, <code>koi</code> 

<ul>
<li>with label <code>ko</code>, 

<ul>
<li>property <code>ko</code> of value <code>ko:K00531</code></li>
</ul></li>
</ul></li>
</ul>

</div>
<div style='float:right;width:48%;'>
  <h3>R code</h3>

<pre><code class="r">nodeOfInterest &lt;-
graph %&gt;% getNodes(
    query = &quot;MATCH  (koi:ko {ko:&#39;ko:K00531&#39;})
             RETURN koi&quot;
    )
</code></pre>

<p>Node returned by the query is saved as a variable in R.</p>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-13" style="background:;">
  <hgroup>
    <h2>2a. Cypher Query  - Returning as NODE &quot;object&quot;</h2>
  </hgroup>
  <article data-timings="">
    
<div style='float:left;width:48%;' class='centered'>
  <h3>Node Attributes</h3>

<p><li>names</li><li>self</li><li>property</li><li>properties</li><li>labels</li><li>create_relationship</li><li>incoming_relationships</li><li>outgoing_relationships</li><li>class</li><li>username</li><li>password</li></p>

<ul>
<li><strong>Self</strong> stores the ID, thats how the functions deal with this node</li>
</ul>

</div>
<div style='float:right;width:48%;'>
  <h3>Node Data</h3>

<pre><code>## List of 5
##  $ : chr &quot;nitrogenase delta subunit [EC:1.18.6.1]&quot;
##  $ : chr &quot;path:ko00625|path:ko00910|path:ko01100|path:ko01120&quot;
##  $ : chr &quot;Chloroalkane and chloroalkene degradation|Nitrogen metabolism|Metabolic pathways|Microbial metabolism in diverse environments&quot;
##  $ : chr &quot;anfG&quot;
##  $ : chr &quot;ko:K00531&quot;
</code></pre>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-14" style="background:;">
  <hgroup>
    <h2>2b. Cypher Query - Returning as data.frame</h2>
  </hgroup>
  <article data-timings="">
    <p>If you know the property you&#39;re interested in, you could plan the query to return it as a data.frame</p>

<pre><code class="r">df = graph %&gt;%
cypher(
&quot;MATCH
    (koi:ko {ko:&#39;ko:K00531&#39;})
RETURN
    koi.ko,
    koi.definition,
    koi.name
    &quot;)
</code></pre>

<pre><code>##      koi.ko                          koi.definition koi.name
## 1 ko:K00531 nitrogenase delta subunit [EC:1.18.6.1]     anfG
</code></pre>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-15" style="background:;">
  <hgroup>
    <h2>Creating a node</h2>
  </hgroup>
  <article data-timings="">
    <pre><code class="r">graph2 = startGraph(&quot;http://localhost:7474/db/data/&quot;)
bob = graph2 %&gt;%
        createNode(&quot;Person&quot;, 
                   name = &quot;Bob&quot;, 
                   age = 24, 
                   kids = c(&quot;Jenny&quot;, &quot;Larry&quot;))
#attributes(bob)$self
</code></pre>

<div class="centered">
<img src="./assets/img/oneNode.png" height="20%", width="60%">
</div>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-16" style="background:;">
  <hgroup>
    <h2>Edge creation</h2>
  </hgroup>
  <article data-timings="">
    <pre><code class="r">alice   = createNode(graph2, &quot;Person&quot;, name = &quot;Alice&quot;)
#attributes(alice)$self
charles = createNode(graph2, &quot;Person&quot;, name = &quot;Charles&quot;)
#attributes(charles)$self

createRel(alice, &quot;WORKS_WITH&quot;, bob)
createRel(bob, &quot;KNOWS&quot;, charles, since = 2000, through = &quot;Work&quot;)
createRel(alice, &quot;KNOWS&quot;, charles, list(since = 2001, through = &quot;School&quot;))
</code></pre>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-17" style="background:;">
  <article data-timings="">
    
<div style='float:left;width:48%;' class='centered'>
  <h2>Visualising in Igraph</h2>

<p>Using cypher get the subgraph which you&#39;re interested in and return as an edge list.</p>

<pre><code class="r">edgelist = graph %&gt;% cypher(
&quot;
UNWIND
    {names} AS namelist
MATCH
    (p:Person {name:namelist}) -- (connection:Person)
RETURN
    p.name,
    connection.name
&quot;, list(names = c(&quot;Alice&quot;, &quot;Bob&quot;, &quot;Charles&quot;))
)
</code></pre>

<pre><code>## Error in UseMethod(&quot;cypher&quot;): no applicable method for &#39;cypher&#39; applied to an object of class &quot;function&quot;
</code></pre>

<pre><code class="r">edgelist %&lt;&gt;% setNames(c(&quot;from&quot;, &quot;to&quot;))
edgelist
</code></pre>

<pre><code>##       from      to
## 1    Alice Charles
## 2    Alice Charles
## 3    Alice Charles
## 4    Alice Charles
## 5    Alice Charles
## 6    Alice Charles
## 7  Charles   Alice
## 8  Charles   Alice
## 9  Charles   Alice
## 10 Charles   Alice
## 11 Charles   Alice
## 12 Charles   Alice
</code></pre>

</div>
<div style='float:right;width:48%;'>
  <h3>Extraction</h3>

<ul>
<li>subgraphs</li>
<li>order</li>
<li>cliches</li>
</ul>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-18" style="background:;">
  <hgroup>
    <h2>Common Network analyses</h2>
  </hgroup>
  <article data-timings="">
    
<div style='float:left;width:48%;' class='centered'>
  <p><img src="https://cdn.vectorstock.com/i/composite/19,21/flatnose-pliers-vector-1031921.jpg" alt="plyer"></p>

</div>
<div style='float:right;width:48%;'>
  <h3>Algorithms</h3>

<ul>
<li>shortest path</li>
<li>Lowest Common Ancestor</li>
<li>Centrality</li>
<li>Betweeness</li>
</ul>

</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-19" style="background:;">
  <article data-timings="">
    
<div style='float:left;width:48%;' class='centered'>
  
</div>
<div style='float:right;width:48%;'>
  
</div>
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-20" style="background:;">
  <hgroup>
    <h2>Metabolic graph</h2>
  </hgroup>
  <article data-timings="">
    
  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="" id="slide-21" style="background:;">
  <hgroup>
    <h2>Example Query</h2>
  </hgroup>
  <article data-timings="">
    <pre><code class="cypher">UNWIND
    { kos } AS koss
OPTIONAL MATCH
    (ako:ko {ko: koss.ko})&lt;--(cpd:cpd)
RETURN 
    cpd.cpd        AS child,
    ako.ko         AS parent,
    ako.definition AS parentName,
    ako.name       AS parentSym,
    cpd.name       AS childName,
    cpd.name       AS childSym
</code></pre>

  </article>
  <!-- Presenter Notes -->
</slide>

<slide class="sessionInfo" id="slide-22" style="background:;">
  <article data-timings="">
    <pre><code>## R version 3.1.1 (2014-07-10)
## Platform: x86_64-apple-darwin13.1.0 (64-bit)
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] XML_3.98-1.3           shiny_0.12.2           magrittr_1.5          
##  [4] dplyr_0.4.1            MetamapsDB_0.0.2       slidifyLibraries_0.3.1
##  [7] slidify_0.4.5          igraph_1.0.1           visNetwork_0.1.0      
## [10] digest_0.6.8           RNeo4j_1.6.1           setwidth_1.0-4        
## [13] colorout_1.0-3        
## 
## loaded via a namespace (and not attached):
##  [1] assertthat_0.1    codetools_0.2-14  curl_0.9.3       
##  [4] DBI_0.3.1         devtools_1.9.0    evaluate_0.7.2   
##  [7] formatR_1.2       htmltools_0.2.6   htmlwidgets_0.5.1
## [10] httpuv_1.3.3      httr_1.0.0        jsonlite_0.9.16  
## [13] knitr_1.10.5      markdown_0.7.7    memoise_0.2.1    
## [16] mime_0.3          parallel_3.1.1    R6_2.1.1         
## [19] Rcpp_0.12.0       rjson_0.2.15      RJSONIO_1.3-0    
## [22] rstudioapi_0.3.1  sigma_1.0         stringi_0.5-5    
## [25] stringr_1.0.0     tools_3.1.1       whisker_0.3-2    
## [28] xtable_1.7-4      yaml_2.1.13
</code></pre>

  </article>
  <!-- Presenter Notes -->
</slide>

    <slide class="backdrop"></slide>
  </slides>
  <div class="pagination pagination-small" id='io2012-ptoc' style="display:none;">
    <ul>
      <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=1 title='NA'>
         1
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=2 title='Outline'>
         2
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=3 title='What is a graph'>
         3
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=4 title='Why NEO4J - Pattern Search'>
         4
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=5 title='Why use NEO4J'>
         5
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=6 title='Why NEO4J?'>
         6
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=7 title='NODE LABELS'>
         7
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=8 title='CYPHER: EDGE LABELS'>
         8
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=9 title='CYPHER: Path'>
         9
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=10 title='Using R with Neo4j'>
         10
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=11 title='Cypher Functions 101'>
         11
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=12 title='2. Sending A query'>
         12
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=13 title='2a. Cypher Query  - Returning as NODE &quot;object&quot;'>
         13
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=14 title='2b. Cypher Query - Returning as data.frame'>
         14
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=15 title='Creating a node'>
         15
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=16 title='Edge creation'>
         16
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=17 title='NA'>
         17
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=18 title='Common Network analyses'>
         18
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=19 title='NA'>
         19
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=20 title='Metabolic graph'>
         20
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=21 title='Example Query'>
         21
      </a>
    </li>
    <li>
      <a href="#" target="_self" rel='tooltip' 
        data-slide=22 title='NA'>
         22
      </a>
    </li>
  </ul>
  </div>  <!--[if IE]>
    <script 
      src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js">  
    </script>
    <script>CFInstall.check({mode: 'overlay'});</script>
  <![endif]-->
</body>
  <!-- Load Javascripts for Widgets -->
  
  <!-- LOAD HIGHLIGHTER JS FILES -->
  <!--<script src="libraries/highlighters/highlight.js/highlight.pack.js"></script>-->
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/highlight.min.js"></script>
  <script type="text/javascript" src="libraries/highlighters/highlightjs-cypher/javascripts/cypher.js"></script>
  <link href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/styles/default.min.css" rel="stylesheet" />
  <link href="libraries/highlighters/highlightjs-cypher/css/cypher-highlighting.css" rel="stylesheet"/>
  
  <script type="text/javascript">
  hljs.registerLanguage("cypher", cypher);
  hljs.initHighlightingOnLoad();
  </script> 
  
  <!-- DONE LOADING HIGHLIGHTER JS FILES -->
   
  </html>